twDevB::set_machine_libPath()
devtools::document(roclets=c('rd', 'collate', 'namespace'))
library(ETPart)
dci = compute_diurnal_centroid(df$ET)
library(testthat)
library(dplyr)
set.seed(0815)
nday = 367
isprecip = rpois(48*nday, 0.005)
.dsin = -cos(1:(nday*48)*2*pi/48)
#plot(.sin)
df <- data.frame(
timestamp = seq(
ISOdate(2018, 1, 1, 0, tz = "Etc/GMT-1"), by = "30 min", length.out = 48*nday)
,GPP = pmax(0,.dsin)
,precip = isprecip * 5*rlnorm(48*nday)
,ET = 1/24*pmax(0,.dsin)
)
dci = compute_diurnal_centroid(df$ET)
expect_equal(length(dci), nday)
dci
expect_equal(dci[1], 12)
df2$ET[48+2*10]
#increase ET at 10:00am at second day
df2 <- df; df2$ET[48+2*10] <- 2*df2$ET[48+2*10]
dci = compute_diurnal_centroid(df$ET)
expect_equal(length(dci), nday)
expect_equal(dci[1], 12)
dci
dci = compute_diurnal_centroid(df2$ET)
expect_equal(length(dci), nday)
expect_true(dci[2] < 12)
dci[2]
set.seed(0815)
nday = 367
isprecip = rpois(48*nday, 0.005)
.dsin = -cos(1:(nday*48)*2*pi/48)
#plot(.sin)
df <- data.frame(
timestamp = seq(
ISOdate(2018, 1, 1, 0, tz = "Etc/GMT-1"), by = "30 min", length.out = 48*nday)
,GPP = pmax(0,.dsin)
,precip = isprecip * 5*rlnorm(48*nday)
,ET = 1/24*pmax(0,.dsin)
,Rg = 200 * pmax(0,.dsin)
)
library(ETPart)
#increase ET at 10:00am at second day
# so that dci is shifted towards morning for second day
df2 <- df; df2$ET[48+2*10] <- 2*df2$ET[48+2*10]
#
ndci <- compute_norm_diurnal_centroid(df2$ET, df2$Rg)
ndci
expect_equal(ndci[1], 0)
expect_equal(ndci[2], dci[2] - 12)
?range
?corr
?cor
?complete.cases
corf <- function(x,y)
mean( (x-mean(x))*(y-mean(y)) ) / (sd(x)*sd(y))
}
corf <- function(x,y) {
mean( (x-mean(x))*(y-mean(y)) ) / (sd(x)*sd(y))
}
corf(df$ET, df$precip)
cor(df$ET, df$precip)
cor(df$ET, df$precip, method = "pearson")
cor(df$ET, df$precip, method = "kendall")
cor(df$ET, df$precip, method = "spearman")
cor
library(ETPart)
library(ETPart)
#increase ET at 10:00am at second day
# so that dci is shifted towards morning for second day
df2 <- df; df2$ET[48+2*10] <- 2*df2$ET[48+2*10]
dci = ETPart:::daily_corr(df2$ET, df2$GPP)
dci = ETPart:::daily_corr(df2$ET, df2$GPP, df2$Rg)
devtools::document(roclets=c('rd', 'collate', 'namespace'))
twDevB::set_machine_libPath()
devtools::document(roclets=c('rd', 'collate', 'namespace'))
library(ETPart)
library(testthat)
set.seed(0815)
nday = 367
isprecip = rpois(48*nday, 0.005)
.dsin = -cos(1:(nday*48)*2*pi/48)
#plot(.sin)
df <- data.frame(
timestamp = seq(
ISOdate(2018, 1, 1, 0, tz = "Etc/GMT-1"), by = "30 min", length.out = 48*nday)
,GPP = pmax(0,.dsin)
,precip = isprecip * 5*rlnorm(48*nday)
,ET = 1/24*pmax(0,.dsin)
,Rg = 200 * pmax(0,.dsin)
)
#increase ET at 10:00am at second day
# so that dci is shifted towards morning for second day
df2 <- df; df2$ET[48+2*10] <- 2*df2$ET[48+2*10]
dci = ETPart:::daily_corr(df2$ET, df2$GPP, df2$Rg)
?drop_na
library(ETPart)
dci = ETPart:::daily_corr(df2$ET, df2$GPP, df2$Rg)
dci
dci
dci = ETPart:::daily_corr(df2$ET, df2$GPP, df2$Rg)
dff
nday = length(x) / units_per_day
dff <- data.frame(
x = x, y = y, Rg_pot = Rg_pot,
iday = rep(1:nday, each = units_per_day)
)
dff
ans <- dff %>%
filter(complete.cases(.)) %>%
filter(Rg_pot > 0) %>%
group_by(iday) %>%
summarise(
r2 = cor(x,y)^2
)
ans
ans$r2
library(ETPart)
#increase ET at 10:00am at second day
# so that dci is shifted towards morning for second day
df2 <- df; df2$ET[48+2*10] <- 2*df2$ET[48+2*10]
dci = ETPart:::daily_corr(df2$ET, df2$GPP, df2$Rg)
expect_equal(length(dci), nday)
expect_equal(dci[1], 1.0)
expect_true(dci[2] < 1.0)
cor(rep(0,3), rep(0,3))
library(ETPart)
devtools::install_github("bgctw/ncdfTools")
